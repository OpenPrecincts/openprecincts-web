{% extends "base.html" %}
{% load common %}

{% block body %}
<section class="section">
<div class="container">    
    <h1 class="title is-2">{{ state }}</h1>

    {# top section: overview of where things are at and where they're going next #}

    {% if state.status.value == "unknown" %}
    <p>
        We haven't yet determined the best course of action for {{ state }}.  If you're interested in helping us get started <a href="mailto:gerrymander@princeton.edu">contact us</a> and we'd be glad to work with you to get things started here!
    </p>

    {% else %}

    <div class="columns">
        <div class="column state-stage-{{ state.collection_status }}">
            <h2 class="title is-4">Collection</h2>

            <ul>
            {% state_status_item state.task_collect "Collect Contact Information" %}
            {% state_status_item state.task_contact "Contact Officials" %}
            {% state_status_item state.task_files "Raw File Collection" %}
            </ul>
        </div>

        <div class="column state-stage-{{ state.cleaning_status }}">
            <h2 class="title is-4">Cleaning</h2>
            <ul>
                {% state_status_item state.task_digitization "Digitization" %}
            </ul>
        </div>

        <div class="column state-stage-{{ state.final_status }}">
            <h2 class="title is-4">Finalization</h2>
            <ul>
                {% state_status_item state.task_verification "Verification" %}
                {% state_status_item state.task_published "Published" %}
            </ul>
        </div>
    </div>

    {% endif %}
</div>
</section>

{% if contributors %}
<section class="section">
<div class="container">    
    <h3 class="title is-3">Top Contributors</h3>
    <table class="table">
        <thead>
            <th>User</th>
            <th>Officials</th>
            <th>Files Gathered</th>
        </thead>

        {% for user in contributors %}
        <tr>
            <td>{{ user.name }}</td>
            <td>{{ user.num_officials }}</td>
            <td>{{ user.num_files }}</td>
            </tr>
        {% endfor %}
    </table>
</div>
</section>
{% endif %}

{% if state.collection_status == "wip" %}
<section class="section">
<div class="container">    
    <h3 class="title is-3">Data Collection</h3>

    <div class="level">
        <div class="level-item has-text-centered">
         <div class="allow-wide">
          <p class="heading">Officials</p>
          <p class="title">{{ total_officials }}</p>
          <progress class="progress is-link" value="{{ localities_with_officials }}" max="{{ localities|length }}"></progress>
          <p class="fraction">
              {{ localities_with_officials }}/{{ localities|length }}
          </p>
          </div>
      </div>

      <div class="level-item has-text-centered">
        <div class="allow-wide">
          <p class="heading">Contacted</p>
          <p class="title">{{ total_contacts }}</p>
          <progress class="progress is-link" value="{{ localities_with_contacts }}" max="{{ localities|length }}"></progress>
          <p class="fraction">
              {{ localities_with_contacts }}/{{ localities|length }}
          </p>
        </div>
      </div>

      <div class="level-item has-text-centered">
        <div class="allow-wide">
          <p class="heading">Files</p>
          <p class="title">{{ total_files }}</p>
          <progress class="progress is-link" value="{{ localities_with_files }}" max="{{ localities|length }}"></progress>
          <p class="fraction">
              {{ localities_with_files }}/{{ localities|length }}
          </p>
        </div>
     </div>

  </div>


{% if localities %}
    <table class="table">
    <thead>
        <th>Locality</th>
        <th>Officials</th>
        <th>Contacts Made</th>
        <th>Files Received</th>
    </thead>
    <tbody>
    {% for locality in localities %}
    <tr>
        <td><a href="{% url "locality_overview" locality.id %}">{{ locality.name }}</a></td>
        <td>{{ locality.total_officials }} </td>
        <td>{{ locality.total_contacts }} </td> 
        <td>{{ locality.total_files }} </td> 
    </tr>
    {% endfor %}
    </tbody>
    </table>
{% endif %}
</div>
</section>
{% endif %}

{% endblock %}
