{% extends "base.html" %}
{% load common %}

{% block body %}

<section class="section">
<div class="container">
    <h1 class="title is-2">{{ locality.name }}</h1>
    <p class="subtitle is-3">{{ locality.state }}</p>
</div>
</section>

<section class="section">
<div class="container">
    <h2 class="title is-3">Officials</h2>

    {% if user_can_write %}
    <button class="button is-primary" data-reveal="official">Add Official</button>
    <div class="box simpleform" data-hidden="official">
    <form method="POST">
        <input type="hidden" name="locality" value="{{ locality.id }}">
        {% render_form official_form %}
        {% csrf_token %}
        <input type="submit" class="button is-primary">
    </form>
    </div>
    {% endif %}

    {% if not officials %}
        <p>So far we haven't collected any officials.  </p>
    {% else %}
        {% for official in officials %}

        <div class="box official">
            <span class="title is-5">{{ official.title }} {{ official.first_name }} {{official.last_name }}</span>
            <span>{{ official.job_title }}</span>
            {% if user_can_contact or request.user == official.created_by %}
            <div>
                <span class="icon has-text-info">
                  <i class="fas fa-phone"></i>
                </span>
                <a href="tel:{{ official.phone_number }}">{{ official.phone_number }}</a>
                <span class="icon has-text-info">
                  <i class="fas fa-at"></i>
                </span>
                <a href="mailto:{{ official.email }}">{{ official.email }}</a>
            </div>
            {% else %}
            <p>Contact details hidden for privacy.</p>
            {% endif %}
            <div>{{ official.notes }}</div>
        </div>
        {% endfor %}
    {% endif %}
</div>
</section>

<section class="section">
<div class="container">
    <h3 class="title is-3">Contact Log</h3>
    {% if not contact_log %}
        This official has not yet been contacted.
    {% else %}
        <table class="table">        
        <thead>
            <tr>
                <th>Official</th>
                <th>Date</th>
                <th>Notes</th>
            </tr>
        </thead>
        <tbody>
        {% for cl in contact_log %}
            <tr>
                <td>{{ cl.official }}</td>
                <td>{{ cl.contact_date }}</td>
                <td>{{ cl.notes }}</td>
            </tr>
        {% endfor %}
        </tbody>
        </table>
    {% endif %}
</div>
</section>

<section class="section">
<div class="container">
    <h3 class="title is-3">File Management</h3>

    {% if user_can_write %}
    <h4>Add Files</h4>
    <form action="{% url 'upload' %}" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="hidden" name="locality" value="{{ locality.id }}">

        <div class="file">
          <label class="file-label">
            <input class="file-input" type="file" name="files" multiple>
            <span class="file-cta">
              <span class="file-icon">
                <i class="fas fa-upload"></i>
              </span>
              <span class="file-label">
                Select filesâ€¦
              </span>
            </span>
          </label>
        </div>

        <input type="submit">
    </form>
    {% endif %}

    <table class="table">        
    <thead>
        <tr>
            <th>Status</th>
            <th>File Name</th>
            <th>Date</th>
            <th>Link</th>
        </tr>
    </thead>
    <tbody>
    {% for f in files %}
        <tr>
            <td>{{ f.get_stage_display }}</td>
            <td>{{ f.source_filename }}</td>
            <td>{{ f.created_at }}</td>
            {% if user.is_authenticated %}
            <td><a href="{% url "download" f.id %}">Download</a></td>
            {% else %}
            <td><a href="{% url 'login' %}">login</a> to see files</td>
            {% endif %}
        </tr>
    {% endfor %}
    </tbody>
    </table>
</div>
</section>
{% endblock %}
